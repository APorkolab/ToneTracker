const l={DEBUG:"debug",INFO:"info",WARN:"warn",ERROR:"error",FATAL:"fatal"},d={VALIDATION:"validation",NETWORK:"network",AUDIO:"audio",GAME_LOGIC:"game_logic",UI:"ui",STORAGE:"storage"};class p extends Error{constructor(e,t=d.GAME_LOGIC,r=l.ERROR,s={}){super(e),this.name="ToneTrackerError",this.category=t,this.level=r,this.context=s,this.timestamp=new Date().toISOString(),this.stack=Error.captureStackTrace?Error.captureStackTrace(this,p):this.stack}}class T{constructor(){this.logs=[],this.maxLogs=100,this.isProduction=!0}log(e,t={}){const r={timestamp:new Date().toISOString(),message:e.message,stack:e.stack,category:e.category||d.GAME_LOGIC,level:e.level||l.ERROR,context:{...e.context,...t},url:window.location.href,userAgent:navigator.userAgent};this.logs.push(r),this.logs.length>this.maxLogs&&this.logs.shift(),this.logToConsole(r),this.isProduction&&this.logToExternalService(r),(r.level===l.FATAL||r.level===l.ERROR)&&this.storeErrorLocally(r)}logToConsole(e){const t={[l.DEBUG]:"debug",[l.INFO]:"info",[l.WARN]:"warn",[l.ERROR]:"error",[l.FATAL]:"error"}[e.level]||"log";console[t](`[${e.timestamp}] [${e.category}] ${e.message}`,e.context,e.stack)}storeErrorLocally(e){try{const t=JSON.parse(localStorage.getItem("tonetracker_errors")||"[]");t.push(e),t.length>20&&t.splice(0,t.length-20),localStorage.setItem("tonetracker_errors",JSON.stringify(t))}catch(t){console.warn("Failed to store error locally:",t)}}logToExternalService(){}getRecentLogs(e=10){return this.logs.slice(-e)}clearLogs(){this.logs=[],localStorage.removeItem("tonetracker_errors")}}const I=new T;class v{constructor(){if(v.instance)return v.instance;this.logger=I,this.setupGlobalHandlers(),v.instance=this}setupGlobalHandlers(){window.addEventListener("unhandledrejection",e=>{this.handleError(new p(`Unhandled Promise Rejection: ${e.reason}`,d.GAME_LOGIC,l.ERROR,{reason:e.reason}))}),window.addEventListener("error",e=>{this.handleError(new p(`Uncaught Exception: ${e.message}`,d.GAME_LOGIC,l.ERROR,{filename:e.filename,lineno:e.lineno,colno:e.colno,error:e.error}))})}handleError(e,t={},r=!0){this.logger.log(e,t),r&&this.showUserError(e)}showUserError(e){const t=this.getUserFriendlyMessage(e);let r=document.getElementById("error-notification");r||(r=document.createElement("div"),r.id="error-notification",r.className="error-notification",document.body.appendChild(r)),r.textContent=t,r.style.display="block",setTimeout(()=>{r.style.display="none"},5e3)}getUserFriendlyMessage(e){return{[d.VALIDATION]:"Érvénytelen adat. Kérjük, ellenőrizze a bevitt értékeket.",[d.NETWORK]:"Hálózati hiba történt. Kérjük, próbálja újra később.",[d.AUDIO]:"Hang lejátszási hiba. Ellenőrizze a hang beállításokat.",[d.GAME_LOGIC]:"Hiba történt a játék során. A játék automatikusan újraindul.",[d.UI]:"Megjelenítési hiba történt. Kérjük, frissítse az oldalt.",[d.STORAGE]:"Adattárolási hiba. Ellenőrizze a böngésző beállításait."}[e.category]||"Váratlan hiba történt. Kérjük, próbálja újra."}wrapAsync(e,t="async operation"){return async(...r)=>{try{return await e(...r)}catch(s){throw this.handleError(s instanceof p?s:new p(`Error in ${t}: ${s.message}`,d.GAME_LOGIC,l.ERROR,{originalError:s.message,context:t})),s}}}wrapSync(e,t="sync operation"){return(...r)=>{try{return e(...r)}catch(s){throw this.handleError(s instanceof p?s:new p(`Error in ${t}: ${s.message}`,d.GAME_LOGIC,l.ERROR,{originalError:s.message,context:t})),s}}}getErrorStats(){const e=this.logger.logs,t={total:e.length,byLevel:{},byCategory:{},recent:this.logger.getRecentLogs(5)};return e.forEach(r=>{t.byLevel[r.level]=(t.byLevel[r.level]||0)+1,t.byCategory[r.category]=(t.byCategory[r.category]||0)+1}),t}}v.instance=null;new v;const h={GAME_STATISTICS:"tonetracker_game_stats",USER_PREFERENCES:"tonetracker_user_prefs",HIGH_SCORES:"tonetracker_high_scores",GAME_HISTORY:"tonetracker_game_history",SETTINGS:"tonetracker_settings",LOCALE:"tonetracker_locale",ERRORS:"tonetracker_errors"},m=1,w={version:m,totalGames:0,gamesWon:0,gamesLost:0,totalScore:0,bestScore:0,averageScore:0,totalTimeSpent:0,averageTime:0,bestTime:null,currentStreak:0,bestStreak:0,difficultyCounts:{easy:{played:0,won:0,totalScore:0},medium:{played:0,won:0,totalScore:0},hard:{played:0,won:0,totalScore:0}},colorAccuracyHistory:[],sessionStats:{startTime:null,gamesPlayed:0,gamesWon:0},achievements:[],lastPlayed:null,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},y={version:m,difficulty:"easy",soundEnabled:!0,animationsEnabled:!0,showPercentageFeedback:!0,showTimer:!0,colorFormat:"hex",theme:"light",autoStartNextGame:!1,showHints:!0,preferredLanguage:"hu",accessibility:{reduceMotion:!1,highContrast:!1,screenReaderMode:!1,largerText:!1},createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},b={version:m,scores:[],maxScores:100,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};class R{constructor(){this.isSupported=this.checkStorageSupport(),this.cache=new Map,this.listeners=new Map,this.isSupported&&this.migrateData()}checkStorageSupport(){try{const e="__storage_test__";return localStorage.setItem(e,"test"),localStorage.removeItem(e),!0}catch(e){return console.warn("LocalStorage is not available:",e),!1}}migrateData(){try{const e=this.getRaw(h.GAME_STATISTICS);e&&(!e.version||e.version<m)&&this.migrateGameStatistics(e);const t=this.getRaw(h.USER_PREFERENCES);t&&(!t.version||t.version<m)&&this.migrateUserPreferences(t);const r=this.getRaw(h.HIGH_SCORES);r&&(!r.version||r.version<m)&&this.migrateHighScores(r)}catch(e){console.warn("Data migration failed:",e)}}migrateGameStatistics(e){const t={...w,...e};t.version=m,t.updatedAt=new Date().toISOString(),this.set(h.GAME_STATISTICS,t)}migrateUserPreferences(e){const t={...y,...e};t.version=m,t.updatedAt=new Date().toISOString(),this.set(h.USER_PREFERENCES,t)}migrateHighScores(e){const t={...b,...e};t.version=m,t.updatedAt=new Date().toISOString(),this.set(h.HIGH_SCORES,t)}getRaw(e){if(!this.isSupported)return null;try{const t=localStorage.getItem(e);return t?JSON.parse(t):null}catch(t){return console.warn(`Failed to get raw data for key ${e}:`,t),null}}set(e,t){if(!this.isSupported)return console.warn("LocalStorage not supported, data not saved"),!1;try{const r=JSON.stringify(t);return localStorage.setItem(e,r),this.cache.set(e,t),this.notifyListeners(e,t),!0}catch(r){throw new p(`Failed to save data to localStorage: ${r.message}`,d.STORAGE,l.ERROR,{key:e,error:r.message})}}get(e,t=null){if(!this.isSupported)return t;if(this.cache.has(e))return this.cache.get(e);try{const r=localStorage.getItem(e);if(r===null)return t;const s=JSON.parse(r);return this.cache.set(e,s),s}catch(r){return console.warn(`Failed to get data for key ${e}:`,r),t}}remove(e){if(this.isSupported)try{localStorage.removeItem(e),this.cache.delete(e),this.notifyListeners(e,null)}catch(t){console.warn(`Failed to remove key ${e}:`,t)}}clear(){if(this.isSupported)try{Object.values(h).forEach(e=>{localStorage.removeItem(e),this.cache.delete(e)}),console.log("All ToneTracker data cleared from localStorage")}catch(e){console.warn("Failed to clear localStorage:",e)}}getGameStatistics(){return this.get(h.GAME_STATISTICS,{...w})}updateGameStatistics(e){const r={...this.getGameStatistics(),...e,updatedAt:new Date().toISOString()};return("totalGames"in e||"totalScore"in e)&&(r.averageScore=r.totalGames>0?Math.round(r.totalScore/r.totalGames):0),this.set(h.GAME_STATISTICS,r),r}recordGame(e){const{won:t,score:r,time:s,difficulty:a,accuracy:n,targetColor:g,userGuess:E}=e,i=this.getGameStatistics();return i.totalGames+=1,i.totalTimeSpent+=s,i.averageTime=Math.round(i.totalTimeSpent/i.totalGames),t?(i.gamesWon+=1,i.totalScore+=r,i.currentStreak+=1,i.bestStreak=Math.max(i.bestStreak,i.currentStreak),r>i.bestScore&&(i.bestScore=r),(!i.bestTime||s<i.bestTime)&&(i.bestTime=s)):(i.gamesLost+=1,i.currentStreak=0),i.difficultyCounts[a]&&(i.difficultyCounts[a].played+=1,t&&(i.difficultyCounts[a].won+=1,i.difficultyCounts[a].totalScore+=r)),n!==void 0&&(i.colorAccuracyHistory.push(n),i.colorAccuracyHistory.length>50&&i.colorAccuracyHistory.shift()),i.sessionStats.startTime||(i.sessionStats.startTime=new Date().toISOString()),i.sessionStats.gamesPlayed+=1,t&&(i.sessionStats.gamesWon+=1),i.averageScore=i.gamesWon>0?Math.round(i.totalScore/i.gamesWon):0,i.lastPlayed=new Date().toISOString(),i.updatedAt=new Date().toISOString(),this.set(h.GAME_STATISTICS,i),t&&r>0&&this.addHighScore({score:r,time:s,difficulty:a,accuracy:n,date:new Date().toISOString(),targetColor:g,userGuess:E}),i}getUserPreferences(){return this.get(h.USER_PREFERENCES,{...y})}updateUserPreferences(e){const r={...this.getUserPreferences(),...e,updatedAt:new Date().toISOString()};return this.set(h.USER_PREFERENCES,r),r}getHighScores(){return this.get(h.HIGH_SCORES,{...b})}addHighScore(e){const t=this.getHighScores();return t.scores.push({...e,id:Date.now().toString(),timestamp:new Date().toISOString()}),t.scores.sort((r,s)=>s.score!==r.score?s.score-r.score:r.time-s.time),t.scores.length>t.maxScores&&(t.scores=t.scores.slice(0,t.maxScores)),t.updatedAt=new Date().toISOString(),this.set(h.HIGH_SCORES,t),t}getTopScores(e=null,t=10){let s=this.getHighScores().scores;return e&&(s=s.filter(a=>a.difficulty===e)),s.slice(0,t)}subscribe(e,t){return this.listeners.has(e)||this.listeners.set(e,new Set),this.listeners.get(e).add(t),()=>{const r=this.listeners.get(e);r&&(r.delete(t),r.size===0&&this.listeners.delete(e))}}notifyListeners(e,t){const r=this.listeners.get(e);r&&r.forEach(s=>{try{s(t,e)}catch(a){console.warn("Storage listener callback failed:",a)}})}exportData(){const e={};return Object.entries(h).forEach(([t,r])=>{e[t]=this.get(r)}),e.exportedAt=new Date().toISOString(),e.version=m,e}importData(e,t=!1){if(!e||typeof e!="object")throw new p("Invalid data format for import",d.VALIDATION,l.ERROR);try{Object.entries(h).forEach(([r,s])=>{if(e[r])if(t){const a=this.get(s);a&&typeof a=="object"?this.set(s,{...a,...e[r]}):this.set(s,e[r])}else this.set(s,e[r])}),console.log("Data import completed successfully")}catch(r){throw new p(`Data import failed: ${r.message}`,d.STORAGE,l.ERROR,{error:r.message})}}getStorageInfo(){if(!this.isSupported)return{supported:!1};let e=0;const t={};return Object.values(h).forEach(r=>{try{const s=localStorage.getItem(r),a=s?new Blob([s]).size:0;e+=a,t[r]={exists:!!s,size:a,sizeFormatted:this.formatBytes(a)}}catch(s){t[r]={error:s.message}}}),{supported:!0,totalSize:e,totalSizeFormatted:this.formatBytes(e),keys:t,cacheSize:this.cache.size}}formatBytes(e){if(e===0)return"0 Bytes";const t=1024,r=["Bytes","KB","MB","GB"],s=Math.floor(Math.log(e)/Math.log(t));return parseFloat((e/Math.pow(t,s)).toFixed(2))+" "+r[s]}}const f=new R,o={GAME_START:"game_start",GAME_END:"game_end",GAME_WIN:"game_win",GAME_LOSE:"game_lose",COLOR_GUESS:"color_guess",COMPUTER_TIP_USED:"computer_tip_used",DIFFICULTY_CHANGE:"difficulty_change",LANGUAGE_CHANGE:"language_change",THEME_CHANGE:"theme_change",SOUND_TOGGLE:"sound_toggle",PAGE_VIEW:"page_view",SESSION_START:"session_start",SESSION_END:"session_end",FEATURE_USED:"feature_used",ERROR_OCCURRED:"error_occurred",LOAD_TIME:"load_time",RENDER_TIME:"render_time",PERFORMANCE_ISSUE:"performance_issue",ACCESSIBILITY_FEATURE_USED:"accessibility_feature_used",KEYBOARD_NAVIGATION:"keyboard_navigation",SCREEN_READER_DETECTED:"screen_reader_detected"},S={GAME:"game",UI:"ui",PERFORMANCE:"performance",ERROR:"error",USER_JOURNEY:"user_journey",ACCESSIBILITY:"accessibility"},C={maxEvents:1e3,batchSize:50,flushInterval:3e4,sessionTimeout:1800*1e3,enableConsoleLogging:!0,enableLocalStorage:!0,enableExternalReporting:!1,privacyMode:!0,externalService:{endpoint:null,apiKey:null,enabled:!1}};class _{constructor(e={}){this.config={...C,...e},this.events=[],this.sessionId=this.generateSessionId(),this.sessionStart=Date.now(),this.lastActivity=Date.now(),this.batchTimer=null,this.isEnabled=!0,this.userId=this.getUserId(),this.deviceInfo=this.collectDeviceInfo(),this.initializeSession(),this.setupAutoFlush(),this.setupVisibilityHandling(),this.loadStoredEvents()}generateSessionId(){return`session_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getUserId(){let e=f.get("tonetracker_user_id");return e||(e=`user_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,f.set("tonetracker_user_id",e)),e}collectDeviceInfo(){const e=navigator,t=window.screen;return{userAgent:this.config.privacyMode?this.hashString(e.userAgent):e.userAgent,language:e.language,languages:e.languages,platform:e.platform,screenWidth:t.width,screenHeight:t.height,viewportWidth:window.innerWidth,viewportHeight:window.innerHeight,colorDepth:t.colorDepth,pixelRatio:window.devicePixelRatio,touchSupport:"ontouchstart"in window,cookieEnabled:e.cookieEnabled,onlineStatus:e.onLine,timeZone:Intl.DateTimeFormat().resolvedOptions().timeZone,features:{localStorage:this.isLocalStorageAvailable(),webgl:this.isWebGLAvailable(),webAudio:this.isWebAudioAvailable(),gamepads:"getGamepads"in e,geolocation:"geolocation"in e,notifications:"Notification"in window,serviceWorker:"serviceWorker"in e}}}hashString(e){let t=0;for(let r=0;r<e.length;r++){const s=e.charCodeAt(r);t=(t<<5)-t+s,t=t&t}return`hash_${Math.abs(t).toString(36)}`}isLocalStorageAvailable(){try{return typeof Storage<"u"}catch{return!1}}isWebGLAvailable(){try{const e=document.createElement("canvas");return!!(window.WebGLRenderingContext&&e.getContext("webgl"))}catch{return!1}}isWebAudioAvailable(){return!!(window.AudioContext||window.webkitAudioContext)}initializeSession(){this.track(o.SESSION_START,{sessionId:this.sessionId,deviceInfo:this.deviceInfo,timestamp:this.sessionStart})}setupAutoFlush(){this.config.flushInterval>0&&(this.batchTimer=setInterval(()=>{this.flush()},this.config.flushInterval))}setupVisibilityHandling(){document.addEventListener("visibilitychange",()=>{document.hidden?(this.track(o.SESSION_END,{sessionDuration:Date.now()-this.sessionStart,eventsTracked:this.events.length}),this.flush()):this.updateActivity()}),window.addEventListener("beforeunload",()=>{this.track(o.SESSION_END,{sessionDuration:Date.now()-this.sessionStart,eventsTracked:this.events.length}),this.flush(!0)})}loadStoredEvents(){if(this.config.enableLocalStorage)try{const e=f.get("tonetracker_analytics_events",[]);Array.isArray(e)&&(this.events=e.slice(-this.config.maxEvents))}catch(e){console.warn("Failed to load stored analytics events:",e)}}updateActivity(){this.lastActivity=Date.now()}isSessionActive(){return Date.now()-this.lastActivity<this.config.sessionTimeout}track(e,t={},r=null){if(!this.isEnabled)return;this.updateActivity();const s={id:this.generateEventId(),type:e,category:r||this.getCategoryForEvent(e),properties:{...t,sessionId:this.sessionId,userId:this.userId,timestamp:Date.now(),url:window.location.href,userAgent:this.config.privacyMode?"redacted":navigator.userAgent,language:navigator.language,viewport:{width:window.innerWidth,height:window.innerHeight}},createdAt:new Date().toISOString()};this.events.push(s),this.events.length>this.config.maxEvents&&(this.events=this.events.slice(-this.config.maxEvents)),this.config.enableConsoleLogging&&!this.config.privacyMode&&console.log("📊 Analytics Event:",e,t),this.config.enableLocalStorage&&this.storeEvents(),this.events.length>=this.config.batchSize&&this.flush()}generateEventId(){return`evt_${Date.now()}_${Math.random().toString(36).substr(2,9)}`}getCategoryForEvent(e){const t=[o.GAME_START,o.GAME_END,o.GAME_WIN,o.GAME_LOSE,o.COLOR_GUESS,o.COMPUTER_TIP_USED],r=[o.DIFFICULTY_CHANGE,o.LANGUAGE_CHANGE,o.THEME_CHANGE,o.SOUND_TOGGLE],s=[o.LOAD_TIME,o.RENDER_TIME],a=[o.ACCESSIBILITY_FEATURE_USED,o.KEYBOARD_NAVIGATION,o.SCREEN_READER_DETECTED];return t.includes(e)?S.GAME:r.includes(e)?S.UI:s.includes(e)?S.PERFORMANCE:a.includes(e)?S.ACCESSIBILITY:e===o.ERROR_OCCURRED?S.ERROR:S.USER_JOURNEY}storeEvents(){try{f.set("tonetracker_analytics_events",this.events)}catch(e){console.warn("Failed to store analytics events:",e)}}async flush(e=!1){if(this.events.length===0)return;const t=[...this.events];try{this.config.enableExternalReporting&&this.config.externalService.enabled&&await this.sendToExternalService(t),this.updateAnalyticsSummary(t),this.events=[],this.config.enableLocalStorage&&this.storeEvents()}catch(r){if(console.warn("Failed to flush analytics events:",r),!e)return}}async sendToExternalService(e){const{endpoint:t,apiKey:r}=this.config.externalService;if(!t){console.warn("External analytics endpoint not configured");return}const s={events:e,metadata:{source:"ToneTracker",version:"2.0.0",timestamp:new Date().toISOString()}},a=await fetch(t,{method:"POST",headers:{"Content-Type":"application/json",...r&&{Authorization:`Bearer ${r}`}},body:JSON.stringify(s)});if(!a.ok)throw new Error(`Analytics service error: ${a.status}`)}updateAnalyticsSummary(e){try{const t=f.get("tonetracker_analytics_summary",{totalEvents:0,eventCounts:{},lastUpdated:null,sessions:[]});t.totalEvents+=e.length,t.lastUpdated=new Date().toISOString(),e.forEach(s=>{t.eventCounts[s.type]=(t.eventCounts[s.type]||0)+1}),e.filter(s=>s.type===o.SESSION_START).forEach(s=>{t.sessions.push({sessionId:s.properties.sessionId,startTime:s.createdAt,deviceInfo:s.properties.deviceInfo})}),t.sessions.length>100&&(t.sessions=t.sessions.slice(-100)),f.set("tonetracker_analytics_summary",t)}catch(t){console.warn("Failed to update analytics summary:",t)}}trackGameStart(e,t){this.track(o.GAME_START,{difficulty:e,targetColor:this.config.privacyMode?"redacted":t,gameId:this.generateEventId()})}trackGameEnd(e,t,r,s,a){this.track(e?o.GAME_WIN:o.GAME_LOSE,{won:e,score:t,time:r,difficulty:s,accuracy:a,performance:this.calculatePerformanceMetrics(t,r,a)})}trackColorGuess(e,t,r,s){this.track(o.COLOR_GUESS,{userGuess:this.config.privacyMode?"redacted":e,targetColor:this.config.privacyMode?"redacted":t,accuracy:r,isCorrect:s,deltaE:this.calculateDeltaE(e,t)})}trackFeatureUsage(e,t={}){this.track(o.FEATURE_USED,{feature:e,...t})}trackError(e,t={}){this.track(o.ERROR_OCCURRED,{message:e.message,category:e.category||"unknown",level:e.level||"error",stack:this.config.privacyMode?"redacted":e.stack,...t})}trackPerformance(e,t,r={}){this.track(o.RENDER_TIME,{metric:e,value:t,unit:"ms",...r})}calculatePerformanceMetrics(e,t,r){return{scorePerSecond:t>0?e/(t/1e3):0,efficiency:r>0?e/r:0,timeCategory:this.categorizeTime(t)}}categorizeTime(e){return e<1e4?"fast":e<3e4?"medium":e<6e4?"slow":"very_slow"}calculateDeltaE(e,t){try{const r=e.replace("#",""),s=t.replace("#",""),a=parseInt(r.substr(0,2),16),n=parseInt(r.substr(2,2),16),g=parseInt(r.substr(4,2),16),E=parseInt(s.substr(0,2),16),i=parseInt(s.substr(2,2),16),A=parseInt(s.substr(4,2),16);return Math.sqrt(Math.pow(E-a,2)+Math.pow(i-n,2)+Math.pow(A-g,2))}catch{return 0}}getAnalyticsSummary(){return{...f.get("tonetracker_analytics_summary",{}),currentSession:{id:this.sessionId,startTime:this.sessionStart,duration:Date.now()-this.sessionStart,eventsCount:this.events.length,isActive:this.isSessionActive()}}}setEnabled(e){this.isEnabled=e,e||(this.flush(!0),this.clearEvents())}clearEvents(){this.events=[],this.config.enableLocalStorage&&(f.remove("tonetracker_analytics_events"),f.remove("tonetracker_analytics_summary"))}destroy(){this.batchTimer&&clearInterval(this.batchTimer),this.flush(!0)}}const c=new _,G=(u,e,t)=>c.track(u,e,t),U=(u,e)=>c.trackGameStart(u,e),P=(u,e,t,r,s)=>c.trackGameEnd(u,e,t,r,s);class O{constructor(){this.metrics=new Map,this.observers=new Map,this.startTimes=new Map,this.isEnabled=!0,this.initializeObservers(),this.trackPageLoad()}initializeObservers(){if("PerformanceObserver"in window)try{const e=new PerformanceObserver(s=>{s.getEntries().forEach(n=>{n.entryType==="navigation"&&this.recordNavigationMetrics(n)})});e.observe({entryTypes:["navigation"]}),this.observers.set("navigation",e);const t=new PerformanceObserver(s=>{s.getEntries().forEach(n=>{n.entryType==="resource"&&this.recordResourceMetrics(n)})});t.observe({entryTypes:["resource"]}),this.observers.set("resource",t);const r=new PerformanceObserver(s=>{s.getEntries().forEach(n=>{n.entryType==="paint"&&this.recordPaintMetrics(n)})});if(r.observe({entryTypes:["paint"]}),this.observers.set("paint",r),"largest-contentful-paint"in PerformanceObserver.supportedEntryTypes){const s=new PerformanceObserver(a=>{a.getEntries().forEach(g=>{this.recordMetric("largest-contentful-paint",g.startTime)})});s.observe({entryTypes:["largest-contentful-paint"]}),this.observers.set("lcp",s)}if("first-input"in PerformanceObserver.supportedEntryTypes){const s=new PerformanceObserver(a=>{a.getEntries().forEach(g=>{this.recordMetric("first-input-delay",g.processingStart-g.startTime)})});s.observe({entryTypes:["first-input"]}),this.observers.set("fid",s)}if("layout-shift"in PerformanceObserver.supportedEntryTypes){let s=0;const a=new PerformanceObserver(n=>{n.getEntries().forEach(E=>{E.hadRecentInput||(s+=E.value,this.recordMetric("cumulative-layout-shift",s))})});a.observe({entryTypes:["layout-shift"]}),this.observers.set("cls",a)}}catch(e){console.warn("Performance observers not supported:",e)}}trackPageLoad(){"performance"in window&&"timing"in performance&&window.addEventListener("load",()=>{setTimeout(()=>{const e=performance.timing,t=performance.getEntriesByType("navigation")[0],r={dns:e.domainLookupEnd-e.domainLookupStart,tcp:e.connectEnd-e.connectStart,ssl:e.secureConnectionStart>0?e.connectEnd-e.secureConnectionStart:0,ttfb:e.responseStart-e.navigationStart,download:e.responseEnd-e.responseStart,domInteractive:e.domInteractive-e.navigationStart,domContentLoaded:e.domContentLoadedEventEnd-e.navigationStart,domComplete:e.domComplete-e.navigationStart,loadComplete:e.loadEventEnd-e.navigationStart,...t&&{redirectTime:t.redirectEnd-t.redirectStart,workerTime:t.workerStart>0?t.responseStart-t.workerStart:0,fetchTime:t.responseEnd-t.fetchStart}};Object.entries(r).forEach(([s,a])=>{a>=0&&this.recordMetric(`page-load-${s}`,a)}),c.trackPerformance("page-load-total",r.loadComplete)},100)})}recordNavigationMetrics(e){const t={"nav-redirect-time":e.redirectEnd-e.redirectStart,"nav-dns-time":e.domainLookupEnd-e.domainLookupStart,"nav-connect-time":e.connectEnd-e.connectStart,"nav-request-time":e.responseStart-e.requestStart,"nav-response-time":e.responseEnd-e.responseStart,"nav-dom-interactive":e.domInteractive,"nav-dom-content-loaded":e.domContentLoadedEventEnd,"nav-load-complete":e.loadEventEnd};Object.entries(t).forEach(([r,s])=>{s>=0&&this.recordMetric(r,s)})}recordResourceMetrics(e){const t=this.getResourceType(e.name),r=e.responseEnd-e.startTime;this.recordMetric(`resource-${t}-time`,r),r>1e3&&c.track(o.PERFORMANCE_ISSUE,{type:"slow-resource",resource:e.name,duration:r,resourceType:t})}recordPaintMetrics(e){this.recordMetric(e.name,e.startTime),c.trackPerformance(e.name,e.startTime)}getResourceType(e){return e.includes(".js")?"script":e.includes(".css")?"stylesheet":e.match(/\.(jpg|jpeg|png|gif|webp|svg)$/i)?"image":e.match(/\.(woff|woff2|ttf|eot)$/i)?"font":"other"}startTiming(e){this.isEnabled&&this.startTimes.set(e,performance.now())}endTiming(e,t={}){if(!this.isEnabled)return;const r=this.startTimes.get(e);if(r!==void 0){const s=performance.now()-r;this.recordMetric(e,s),this.startTimes.delete(e),c.trackPerformance(e,s,t)}}recordMetric(e,t,r="ms"){if(!this.isEnabled)return;const s={name:e,value:t,unit:r,timestamp:Date.now()};this.metrics.set(e,s),this.checkPerformanceThresholds(e,t)}checkPerformanceThresholds(e,t){const s={"page-load-total":3e3,"largest-contentful-paint":2500,"first-input-delay":100,"cumulative-layout-shift":.1,"first-contentful-paint":1800,"time-to-interactive":3800}[e];s&&t>s&&c.track(o.PERFORMANCE_ISSUE,{metric:e,value:t,threshold:s,severity:t>s*2?"high":"medium"})}getMetrics(){return new Map(this.metrics)}getMetric(e){return this.metrics.get(e)||null}clearMetrics(){this.metrics.clear(),this.startTimes.clear()}generateReport(){const e={timestamp:new Date().toISOString(),metrics:Object.fromEntries(this.metrics),summary:{totalMetrics:this.metrics.size,criticalIssues:0,warnings:0}};return this.metrics.forEach((t,r)=>{const a={"page-load-total":{critical:5e3,warning:3e3},"largest-contentful-paint":{critical:4e3,warning:2500},"first-input-delay":{critical:300,warning:100},"cumulative-layout-shift":{critical:.25,warning:.1}}[r];a&&(t.value>a.critical?e.summary.criticalIssues++:t.value>a.warning&&e.summary.warnings++)}),e}destroy(){this.observers.forEach(e=>e.disconnect()),this.observers.clear(),this.clearMetrics()}}class L{constructor(){this.samples=[],this.lastTime=performance.now(),this.isRunning=!1,this.animationId=null}start(){this.isRunning||(this.isRunning=!0,this.lastTime=performance.now(),this.tick())}stop(){this.isRunning=!1,this.animationId&&cancelAnimationFrame(this.animationId)}tick(){if(!this.isRunning)return;const e=performance.now(),t=e-this.lastTime,r=1e3/t;if(this.samples.push({timestamp:e,fps:r,frameTime:t}),this.samples.length>60&&(this.samples=this.samples.slice(-60)),r<30&&this.samples.length>10){const s=this.samples.reduce((a,n)=>a+n.fps,0)/this.samples.length;s<45&&c.track(o.PERFORMANCE_ISSUE,{type:"low-fps",currentFps:r,averageFps:s,severity:r<20?"critical":"medium"})}this.lastTime=e,this.animationId=requestAnimationFrame(()=>this.tick())}getStats(){if(this.samples.length===0)return null;const e=this.samples.map(r=>r.fps),t=this.samples.map(r=>r.frameTime);return{currentFps:e[e.length-1],averageFps:e.reduce((r,s)=>r+s,0)/e.length,minFps:Math.min(...e),maxFps:Math.max(...e),averageFrameTime:t.reduce((r,s)=>r+s,0)/t.length,samples:this.samples.length}}}const k=new O,N=new L,F=u=>k.startTiming(u),H=(u,e)=>k.endTiming(u,e),M={hu:{gameTitle:"Tonetracker v.2.0.0",gameDescription:"Színfelismerő játék: memorizálj egy színt, majd próbáld meg reprodukálni hex kódok vagy RGB értékek segítségével.",checkButton:"Ellenőriz",computerTipButton:"Gép tippje",newGameButton:"Új játék",closeButton:"Bezár",hexColorInput:"Hex színkód bevitele",hexColorPlaceholder:"Írd be a hex színkódot (pl. ff5733)",hexColorHelp:"Hat karakteres hex kód, például ff5733.",colorAdjustLabel:"Szín módosítása:",colorAdjustHelp:"Hex színkód közvetlen szerkesztése.",difficultyLabel:"Nehézségi szint:",difficultyHelp:"A nehézségi szint meghatározza a rendelkezésre álló tippek számát.",difficultyEasy:"Könnyű (3 tipp)",difficultyMedium:"Közepes (2 tipp)",difficultyHard:"Nehéz (1 tipp)",colorComponents:"Szín komponensek:",redChannel:"Vörös",greenChannel:"Zöld",blueChannel:"Kék",increaseValue:"{{channel}} érték növelése 1-gyel",decreaseValue:"{{channel}} érték csökkentése 1-gyel",skipToMain:"Ugrás a fő tartalomra",gameArea:"Játék terület",colorComparison:"Szín összehasonlító terület",targetColor:"Megjegyzendő szín",userColor:"Az általad beállított szín",targetColorHelp:"Ez a szín jelenik meg 3 másodpercig. Memorizáld és próbáld reprodukálni.",gameControls:"Játék vezérlő gombok",gameStats:"Játék statisztikák",rgbControls:"RGB értékek finomhangolása",creatorInfo:"Alkotó információk",checkButtonHelp:"Ellenőrzi a beírt színkódot és visszajelzést ad.",computerTipHelp:"Gép által generált tipp a helyes színhez.",newGameHelp:"Új játék indítása - egy véletlen szín jelenik meg 3 másodpercig.",memorizeColor:"Memorizáld a színt!",congratulations:"Gratulálok! Eltaláltad!",sorry:"Sajnálom, nem találtad el.",tryAgain:"Próbáld újra! Még {{count}} tippelési lehetőséged van. ",noMoreTips:"Nincs több tipp",computerTip:"Gép tippje ({{count}} maradt)",invalidColor:"Érvénytelen színkód, alapértelmezettre állítva.",colorAccuracy:"A tipp {{percentage}}%-ban helyes.",veryClose:"Nagyon közel vagy!",goodProgress:"Jó úton haladsz!",needsWork:"Nem rossz, de még dolgoznod kell rajta.",farOff:"Eléggé eltértél a helyes színtől.",time:"Idő",elapsedTime:"Eltelt idő",score:"Pontok",currentScore:"Jelenlegi pontok",seconds:"másodperc",gameResult:"Játék eredménye",correctColorCode:"A helyes színkód:",closeModal:"Ablak bezárása",timeFormat:{hours:"óra",minutes:"perc",seconds:"másodperc"},creatorName:"Dr. Porkoláb Ádám",creatorTitle:"A digitális színek mestere",creatorBio:"Amikor épp nem színkódokat tör be, akkor új módszereket talál ki a virtuális szivárványok hajszolására. Következetesen a 'Hex-kódtörő' címért versenyez, és a billentyűzetével töri fel a színes világok titkait.",contact:"Elérhetőség:",website:"Profiloldal:",github:"GitHub:",contactEmail:"E-mail küldése Dr. Porkoláb Ádámnak",websiteLink:"Dr. Porkoláb Ádám profiloldala (megnyílik egy új lapon)",githubLink:"GitHub profil (megnyílik egy új lapon)",errors:{validation:"Érvénytelen adat. Kérjük, ellenőrizze a bevitt értékeket.",network:"Hálózati hiba történt. Kérjük, próbálja újra később.",audio:"Hang lejátszási hiba. Ellenőrizze a hang beállításokat.",gameLogic:"Hiba történt a játék során. A játék automatikusan újraindul.",ui:"Megjelenítési hiba történt. Kérjük, frissítse az oldalt.",storage:"Adattárolási hiba. Ellenőrizze a böngésző beállításait.",generic:"Váratlan hiba történt. Kérjük, próbálja újra.",colorComparison:"Hiba történt a színek összehasonlítása során.",audioPlayback:"Hangfájl hiba: ",audioError:"Hiba történt a hang lejátszása közben."}},en:{gameTitle:"Tonetracker v.2.0.0",gameDescription:"Color recognition game: memorize a color, then try to reproduce it using hex codes or RGB values.",checkButton:"Check",computerTipButton:"Computer Tip",newGameButton:"New Game",closeButton:"Close",hexColorInput:"Enter hex color code",hexColorPlaceholder:"Enter hex color code (e.g. ff5733)",hexColorHelp:"Six-character hex code, for example ff5733.",colorAdjustLabel:"Adjust color:",colorAdjustHelp:"Direct hex color code editing.",difficultyLabel:"Difficulty level:",difficultyHelp:"The difficulty level determines the number of available tips.",difficultyEasy:"Easy (3 tips)",difficultyMedium:"Medium (2 tips)",difficultyHard:"Hard (1 tip)",colorComponents:"Color components:",redChannel:"Red",greenChannel:"Green",blueChannel:"Blue",increaseValue:"Increase {{channel}} value by 1",decreaseValue:"Decrease {{channel}} value by 1",skipToMain:"Skip to main content",gameArea:"Game area",colorComparison:"Color comparison area",targetColor:"Target color to memorize",userColor:"Your chosen color",targetColorHelp:"This color appears for 3 seconds. Memorize it and try to reproduce it.",gameControls:"Game control buttons",gameStats:"Game statistics",rgbControls:"RGB values fine-tuning",creatorInfo:"Creator information",checkButtonHelp:"Checks the entered color code and provides feedback.",computerTipHelp:"Computer-generated tip for the correct color.",newGameHelp:"Start a new game - a random color appears for 3 seconds.",memorizeColor:"Memorize the color!",congratulations:"Congratulations! You got it!",sorry:"Sorry, you didn't get it.",tryAgain:"Try again! You have {{count}} more attempts left. ",noMoreTips:"No more tips",computerTip:"Computer tip ({{count}} remaining)",invalidColor:"Invalid color code, reset to default.",colorAccuracy:"Your guess is {{percentage}}% accurate.",veryClose:"Very close!",goodProgress:"You're on the right track!",needsWork:"Not bad, but you need to work on it.",farOff:"You're quite far from the correct color.",time:"Time",elapsedTime:"Elapsed time",score:"Score",currentScore:"Current score",seconds:"seconds",gameResult:"Game Result",correctColorCode:"The correct color code:",closeModal:"Close window",timeFormat:{hours:"hours",minutes:"minutes",seconds:"seconds"},creatorName:"Dr. Ádám Porkoláb",creatorTitle:"Master of Digital Colors",creatorBio:"When not cracking color codes, he invents new methods for chasing virtual rainbows. Consistently competing for the 'Hex-code Breaker' title, breaking the secrets of colorful worlds with his keyboard.",contact:"Contact:",website:"Website:",github:"GitHub:",contactEmail:"Send email to Dr. Ádám Porkoláb",websiteLink:"Dr. Ádám Porkoláb's website (opens in new tab)",githubLink:"GitHub profile (opens in new tab)",errors:{validation:"Invalid data. Please check the entered values.",network:"Network error occurred. Please try again later.",audio:"Audio playback error. Check your sound settings.",gameLogic:"Game error occurred. The game will restart automatically.",ui:"Display error occurred. Please refresh the page.",storage:"Data storage error. Check your browser settings.",generic:"Unexpected error occurred. Please try again.",colorComparison:"Error occurred during color comparison.",audioPlayback:"Audio file error: ",audioError:"Error occurred during audio playback."}}};class x{constructor(){this.currentLocale=this.detectLocale(),this.translations=M,this.fallbackLocale="en",this.cache=new Map}async initialize(e){return e&&this.isLocaleSupported(e)?this.setLocale(e):this.setLocale(this.detectLocale()),Promise.resolve()}detectLocale(){const e=localStorage.getItem("tonetracker_locale");if(e&&this.isLocaleSupported(e))return e;const r=(navigator.language||navigator.userLanguage).split("-")[0];return this.isLocaleSupported(r)?r:"hu"}isLocaleSupported(e){return e&&this.translations&&typeof this.translations=="object"&&e in this.translations}getAvailableLocales(){return Object.keys(this.translations)}setLocale(e){if(!this.isLocaleSupported(e))throw new p(`Unsupported locale: ${e}`,d.VALIDATION,l.ERROR,{locale:e,supportedLocales:this.getAvailableLocales()});this.currentLocale=e,this.cache.clear(),localStorage.setItem("tonetracker_locale",e),document.documentElement.lang=e,window.dispatchEvent(new CustomEvent("localeChanged",{detail:{locale:e,previousLocale:this.currentLocale}}))}getCurrentLocale(){return this.currentLocale}getCurrentLanguage(){return this.getCurrentLocale()}t(e,t={}){const r=`${this.currentLocale}:${e}:${JSON.stringify(t)}`;if(this.cache.has(r))return this.cache.get(r);let s=this.getTranslation(e,this.currentLocale);return s===e&&this.currentLocale!==this.fallbackLocale&&(s=this.getTranslation(e,this.fallbackLocale)),t&&typeof s=="string"&&(s=this.interpolate(s,t)),this.cache.set(r,s),s}getTranslation(e,t){const r=this.translations[t];if(!r)return e;const s=e.split(".");let a=r;for(const n of s)if(a&&typeof a=="object"&&n in a)a=a[n];else return e;return typeof a=="string"?a:e}interpolate(e,t){return e.replace(/\{\{(\w+)\}\}/g,(r,s)=>Object.prototype.hasOwnProperty.call(t,s)?String(t[s]):r)}formatTime(e){const t=Math.floor(e/3600),r=Math.floor(e%3600/60),s=e%60,a=this.t("timeFormat");let n=[];return t>0&&n.push(`${t} ${a.hours}`),(r>0||t>0)&&n.push(`${r} ${a.minutes}`),n.push(`${s} ${a.seconds}`),n.join(" ")}formatPercentage(e,t=2){return`${e.toFixed(t)}%`}getErrorMessage(e){const t=`errors.${e}`,r=this.t(t);return r!==t?r:this.t("errors.generic")}createLanguageSwitcher(e){const t=document.createElement("div");t.className="language-switcher d-flex align-items-center";const r=document.createElement("label");r.textContent=this.t("language")||"Language",r.htmlFor="language-switcher",r.style.marginRight="8px";const s=document.createElement("select");s.id="language-switcher",s.setAttribute("aria-label",this.t("languageSelector")||"Language selector");const a={hu:"Magyar",en:"English"};return this.getAvailableLocales().forEach(n=>{const g=document.createElement("option");g.value=n,g.textContent=a[n]||n.toUpperCase(),g.selected=n===this.currentLocale,s.appendChild(g)}),s.addEventListener("change",n=>{const g=this.currentLocale;this.setLocale(n.target.value),typeof e=="function"&&e(n.target.value,g)}),t.appendChild(r),t.appendChild(s),window.addEventListener("localeChanged",()=>{r.textContent=this.t("language")||"Language",s.setAttribute("aria-label",this.t("languageSelector")||"Language selector")}),e&&e instanceof HTMLElement&&e.appendChild(t),t}clearCache(){this.cache.clear()}getCacheStats(){return{size:this.cache.size,maxSize:1e3,hitRate:this.cacheHits/(this.cacheHits+this.cacheMisses)||0}}}const j=new x;class D{constructor(){this.serviceWorker=null,this.isOnline=navigator.onLine,this.installPrompt=null,this.updateAvailable=!1,this.initialize()}async initialize(){try{await this.registerServiceWorker(),this.setupConnectivityMonitoring(),this.setupInstallPrompt(),this.setupAppLifecycle(),console.log("📱 PWA Manager initialized")}catch(e){console.error("❌ PWA Manager initialization failed:",e)}}async registerServiceWorker(){if(!("serviceWorker"in navigator)){console.warn("⚠️ Service workers not supported");return}try{const e=await navigator.serviceWorker.register("/sw.js",{scope:"/"});this.serviceWorker=e,console.log("✅ Service worker registered:",e.scope),e.addEventListener("updatefound",()=>{this.handleServiceWorkerUpdate(e)}),e.waiting&&this.showUpdatePrompt(),c.track(o.FEATURE_USED,{feature:"service-worker-registration",success:!0})}catch(e){console.error("❌ Service worker registration failed:",e),c.trackError(new p("Service worker registration failed",d.SYSTEM,l.ERROR,{originalError:e.message}))}}handleServiceWorkerUpdate(e){const t=e.installing;console.log("🔄 New service worker installing..."),t.addEventListener("statechange",()=>{t.state==="installed"&&navigator.serviceWorker.controller&&(console.log("✨ New service worker ready!"),this.updateAvailable=!0,this.showUpdatePrompt(),c.track(o.FEATURE_USED,{feature:"service-worker-update",available:!0}))})}showUpdatePrompt(){const e=document.createElement("div");e.className="pwa-update-notification",e.innerHTML=`
      <div class="update-banner">
        <div class="update-content">
          <span class="update-icon">🔄</span>
          <div class="update-text">
            <strong>App Update Available</strong>
            <p>A new version of ToneTracker is ready!</p>
          </div>
          <div class="update-actions">
            <button class="btn btn-primary btn-sm update-btn" onclick="window.pwaManager.applyUpdate()">
              Update Now
            </button>
            <button class="btn btn-secondary btn-sm dismiss-btn" onclick="this.closest('.pwa-update-notification').remove()">
              Later
            </button>
          </div>
        </div>
      </div>
    `;const t=document.createElement("style");t.textContent=`
      .pwa-update-notification {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        z-index: 10000;
        background: rgba(0, 0, 0, 0.1);
        backdrop-filter: blur(5px);
      }
      
      .update-banner {
        background: linear-gradient(135deg, #4f46e5, #7c3aed);
        color: white;
        padding: 16px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
      }
      
      .update-content {
        display: flex;
        align-items: center;
        max-width: 1200px;
        margin: 0 auto;
        gap: 16px;
      }
      
      .update-icon {
        font-size: 24px;
        animation: spin 2s linear infinite;
      }
      
      .update-text {
        flex: 1;
      }
      
      .update-text strong {
        display: block;
        margin-bottom: 4px;
      }
      
      .update-text p {
        margin: 0;
        opacity: 0.9;
        font-size: 14px;
      }
      
      .update-actions {
        display: flex;
        gap: 8px;
      }
      
      .update-btn, .dismiss-btn {
        padding: 8px 16px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-weight: 500;
        transition: all 0.2s ease;
      }
      
      .update-btn {
        background: white;
        color: #4f46e5;
      }
      
      .update-btn:hover {
        background: #f3f4f6;
        transform: translateY(-1px);
      }
      
      .dismiss-btn {
        background: rgba(255, 255, 255, 0.2);
        color: white;
        border: 1px solid rgba(255, 255, 255, 0.3);
      }
      
      .dismiss-btn:hover {
        background: rgba(255, 255, 255, 0.3);
      }
      
      @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
      }
      
      @media (max-width: 768px) {
        .update-content {
          flex-direction: column;
          text-align: center;
        }
        
        .update-actions {
          justify-content: center;
        }
      }
    `,document.head.appendChild(t),document.body.appendChild(e),setTimeout(()=>{e.parentElement&&e.remove()},3e4)}async applyUpdate(){this.serviceWorker&&this.serviceWorker.waiting&&(this.serviceWorker.waiting.postMessage({type:"SKIP_WAITING"}),navigator.serviceWorker.addEventListener("controllerchange",()=>{window.location.reload()}),c.track(o.FEATURE_USED,{feature:"service-worker-update-applied"}))}setupConnectivityMonitoring(){window.addEventListener("online",()=>{console.log("🌐 Connection restored"),this.isOnline=!0,this.hideOfflineIndicator(),c.track(o.FEATURE_USED,{feature:"connectivity-online"})}),window.addEventListener("offline",()=>{console.log("📡 Connection lost"),this.isOnline=!1,this.showOfflineIndicator(),c.track(o.FEATURE_USED,{feature:"connectivity-offline"})}),this.isOnline||this.showOfflineIndicator()}showOfflineIndicator(){this.hideOfflineIndicator();const e=document.createElement("div");e.className="offline-indicator",e.innerHTML=`
      <div style="
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: #dc3545;
        color: white;
        padding: 12px;
        text-align: center;
        z-index: 9999;
        font-weight: 500;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      ">
        <span style="margin-right: 8px;">📡</span>
        You're offline - Some features may not work properly
      </div>
    `,document.body.appendChild(e)}hideOfflineIndicator(){const e=document.querySelector(".offline-indicator");e&&e.remove()}setupInstallPrompt(){window.addEventListener("beforeinstallprompt",e=>{console.log("📱 Install prompt available"),e.preventDefault(),this.installPrompt=e,this.showInstallPrompt(),c.track(o.FEATURE_USED,{feature:"install-prompt-available"})})}showInstallPrompt(){const e=localStorage.getItem("install-prompt-dismissed");if(e&&Date.now()-parseInt(e)<10080*60*1e3)return;const t=document.createElement("div");t.className="install-banner",t.innerHTML=`
      <div style="
        position: fixed;
        bottom: 20px;
        right: 20px;
        background: linear-gradient(135deg, #4f46e5, #7c3aed);
        color: white;
        padding: 16px 20px;
        border-radius: 12px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
        z-index: 1000;
        max-width: 300px;
        animation: slideIn 0.3s ease-out;
      ">
        <div style="display: flex; align-items: center; margin-bottom: 8px;">
          <span style="font-size: 20px; margin-right: 8px;">📱</span>
          <strong>Install ToneTracker</strong>
        </div>
        <p style="margin: 0 0 12px 0; font-size: 14px; opacity: 0.9;">
          Install the app for a better experience!
        </p>
        <div style="display: flex; gap: 8px;">
          <button class="install-yes" style="
            background: white;
            color: #4f46e5;
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            flex: 1;
          ">Install</button>
          <button class="install-no" style="
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            padding: 8px 16px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
          ">Not now</button>
        </div>
      </div>
    `;const r=document.createElement("style");r.textContent=`
      @keyframes slideIn {
        from {
          transform: translateY(100px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
    `,document.head.appendChild(r),document.body.appendChild(t),t.querySelector(".install-yes").addEventListener("click",()=>{this.installApp(),t.remove()}),t.querySelector(".install-no").addEventListener("click",()=>{localStorage.setItem("install-prompt-dismissed",Date.now().toString()),t.remove(),c.track(o.FEATURE_USED,{feature:"install-prompt-dismissed"})}),setTimeout(()=>{t.parentElement&&t.remove()},1e4)}async installApp(){if(this.installPrompt)try{this.installPrompt.prompt();const{outcome:e}=await this.installPrompt.userChoice;console.log("📱 Install outcome:",e),c.track(o.FEATURE_USED,{feature:"app-install-attempt",outcome:e}),this.installPrompt=null}catch(e){console.error("❌ Install failed:",e),c.trackError(new p("App installation failed",d.SYSTEM,l.ERROR,{originalError:e.message}))}}setupAppLifecycle(){window.addEventListener("appinstalled",()=>{console.log("✅ App installed successfully"),c.track(o.FEATURE_USED,{feature:"app-installed-success",timestamp:Date.now()})}),(window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0)&&(console.log("📱 Running as PWA"),document.documentElement.classList.add("pwa-mode"),c.track(o.FEATURE_USED,{feature:"pwa-mode-detected",displayMode:"standalone"})),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"?this.handleAppForeground():this.handleAppBackground()})}handleAppForeground(){console.log("📱 App in foreground"),this.serviceWorker&&this.serviceWorker.update(),c.track(o.FEATURE_USED,{feature:"app-foreground"})}handleAppBackground(){console.log("📱 App in background"),this.syncInBackground(),c.track(o.FEATURE_USED,{feature:"app-background"})}async syncInBackground(){if("serviceWorker"in navigator&&"sync"in window.ServiceWorkerRegistration.prototype)try{await(await navigator.serviceWorker.ready).sync.register("analytics-sync"),console.log("📊 Background sync registered")}catch(e){console.warn("⚠️ Background sync registration failed:",e)}}getStatus(){return{serviceWorkerRegistered:!!this.serviceWorker,isOnline:this.isOnline,canInstall:!!this.installPrompt,updateAvailable:this.updateAvailable,isStandalone:window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0}}async clearAppData(){try{const e=await caches.keys();await Promise.all(e.map(s=>caches.delete(s)));const t=["tonetracker_user_preferences","tonetracker_user_id"];Object.keys(localStorage).forEach(s=>{t.includes(s)||localStorage.removeItem(s)}),console.log("🧹 App data cleared"),c.track(o.FEATURE_USED,{feature:"app-data-cleared"})}catch(e){throw console.error("❌ Failed to clear app data:",e),e}}async requestPersistentStorage(){if("storage"in navigator&&"persist"in navigator.storage)try{const e=await navigator.storage.persist();return console.log("💾 Persistent storage:",e?"granted":"denied"),c.track(o.FEATURE_USED,{feature:"persistent-storage-request",granted:e}),e}catch(e){return console.error("❌ Persistent storage request failed:",e),!1}return!1}}const z=new D;window.pwaManager=z;export{o as E,F as a,c as b,G as c,P as d,H as e,k as f,N as g,j as i,z as p,f as s,U as t};
//# sourceMappingURL=features-WjIVO5NO.js.map
